import{_ as j}from"./JFf_jIA_.js";import{_ as q,v as H}from"./fpd_cD3O.js";import{_ as I}from"./CUVYuoQp.js";import{d as A,N as U,P as V,i as P,o as k,w as a,a as S,e as t,t as d,u as e,c as x,n as R,T as O,f as $,k as Z,m as L,p as G,q as J,F as K,_ as Q,s as W,A as X}from"./8QiH33WF.js";import{u as N}from"./DygIN5F_.js";import{u as M}from"./q1OLa3wU.js";import{u as B}from"./B8ynWgUJ.js";import{u as Y}from"./C3AzuWgF.js";import{_ as tt}from"./CebZ4Rg0.js";import{t as et,o as at,s as nt,_ as ot}from"./Cr4JGMLb.js";import{_ as st}from"./DSEaCN0s.js";import{_ as it,a as rt,b as lt,c as mt,d as ct,e as ut}from"./Oq0BLpzs.js";import{u as pt}from"./B_pj9KdJ.js";import"./DtzL8dFM.js";import"./FTH3AbiA.js";import"./x0I6OrRB.js";import"./5QQhv1ND.js";import"./e2K_0ChY.js";import"./Brao1_R0.js";import"./BJlwRGmy.js";const dt={class:"flex items-center gap-4"},_t={class:"flex-1"},ft={key:0,class:"bg-card/90 absolute inset-0 z-20 flex items-center justify-center"},gt=A({__name:"SaasTeamAvatarForm",setup(D){const i=U(!1),r=U(null),o=U(!1),g=U(),{reloadUser:v,currentTeam:c}=N(),{apiCaller:_}=M(),{toast:f}=V(),{t:l}=B(),m=Z(),T=_.uploads.signedUploadUrl.useMutation(),C=_.team.update.useMutation(),{open:y,onChange:F}=Y({accept:"image/*",multiple:!1});F(n=>{n!=null&&n.length&&(r.value=n[0],o.value=!0)});const b=async n=>{var s;if(!(!n||!c.value)){i.value=!0;try{const u=m.public.s3AvatarsBucketName,p=`${(s=c.value)==null?void 0:s.id}-${H()}.png`,h=await T.mutate({path:p,bucket:u});if(!h)throw new Error("Failed to get upload url");await $fetch(h,{method:"PUT",body:n,headers:{"Content-Type":"image/png"}}),await C.mutate({id:c.value.id,avatarUrl:p}),f({variant:"success",title:l("settings.notifications.avatarUpdated")}),await v()}catch{f({variant:"error",title:l("settings.notifications.avatarNotUpdated")})}finally{i.value=!1}}};return(n,s)=>{const u=j,p=q,h=I;return k(),P(h,null,{title:a(()=>[$(d(n.$t("settings.account.avatar.title")),1)]),default:a(()=>{var z,E;return[S("div",dt,[S("div",_t,[S("p",null,d(n.$t("settings.account.avatar.description")),1)]),S("div",{ref_key:"dropZoneRef",ref:g,class:"relative cursor-pointer rounded-full",onClick:s[0]||(s[0]=w=>e(y)())},[t(u,{class:"size-24 cursor-pointer text-xl",avatarUrl:(z=e(c))==null?void 0:z.avatarUrl,name:((E=e(c))==null?void 0:E.name)??""},null,8,["avatarUrl","name"]),e(i)?(k(),x("div",ft,[t(e(O),{class:"text-primary size-6 animate-spin"})])):R("",!0)],512)]),t(p,{open:e(o),image:e(r),onOpenChange:s[1]||(s[1]=w=>o.value=w),onSave:s[2]||(s[2]=w=>(b(w),o.value=!1))},null,8,["open","image"])]}),_:1})}}}),vt=A({__name:"SaasChangeTeamNameForm",props:{initialValue:{},teamId:{}},setup(D){const i=D,{t:r}=B(),{apiCaller:o}=M(),{toast:g}=V(),{reloadUser:v}=N(),c=et(at({name:nt().min(3)})),{handleSubmit:_,isSubmitting:f,meta:l}=L({validationSchema:c,initialValues:{name:i.initialValue||""}}),m=_(async T=>{try{await o.team.update.mutate({name:T.name,id:i.teamId}),g({variant:"success",title:r("settings.notifications.teamNameUpdated")}),v()}catch{g({variant:"error",title:r("settings.notifications.teamNameNotUpdated")})}});return(T,C)=>{const y=tt,F=st,b=ot,n=J,s=I;return k(),P(s,{onSubmit:e(m),isSubmitting:e(f),isSubmitDisabled:!e(l).valid||!e(l).dirty},{title:a(()=>[$(d(T.$t("settings.team.changeName.title")),1)]),default:a(()=>[S("div",null,[t(n,{name:"name"},{default:a(({componentField:u})=>[t(b,null,{default:a(()=>[t(y,G(u,{type:"text",id:u.name,required:"",autocomplete:"name",class:"max-w-sm"}),null,16,["id"]),t(F)]),_:2},1024)]),_:1})])]),_:1},8,["onSubmit","isSubmitting","isSubmitDisabled"])}}}),Tt=A({__name:"SaasDeleteTeamForm",setup(D){const{t:i}=B(),{toast:r}=V(),o=U(!1),{apiCaller:g}=M(),{currentTeam:v}=N(),{mutate:c,status:_}=g.team.deleteTeam.useMutation(),f=async()=>{if(v.value)try{await c({id:v.value.id}),r({variant:"success",title:i("settings.notifications.teamDeleted")}),window.location.reload()}catch{r({variant:"error",title:i("settings.notifications.teamNotDeleted")})}};return(l,m)=>{const T=I,C=mt,y=ct,F=lt,b=Q,n=ut,s=rt,u=it;return k(),x(K,null,[t(T,{danger:"",onSubmit:m[0]||(m[0]=p=>o.value=!0),"submit-label":e(i)("settings.team.deleteTeam.submit")},{title:a(()=>[$(d(l.$t("settings.team.deleteTeam.title")),1)]),default:a(()=>[S("p",null,d(l.$t("settings.team.deleteTeam.description")),1)]),_:1},8,["submit-label"]),t(u,{open:e(o),"onUpdate:open":m[3]||(m[3]=p=>o.value=p)},{default:a(()=>[t(s,null,{default:a(()=>[t(F,null,{default:a(()=>[t(C,{class:"text-destructive"},{default:a(()=>[$(d(l.$t("settings.team.deleteTeam.title")),1)]),_:1}),t(y,null,{default:a(()=>[$(d(l.$t("settings.team.deleteTeam.confirmation")),1)]),_:1})]),_:1}),t(n,null,{default:a(()=>[t(b,{variant:"outline",onClick:m[1]||(m[1]=p=>o.value=!1)},{default:a(()=>[$(d(l.$t("common.confirmation.cancel")),1)]),_:1}),t(b,{variant:"error",loading:e(_)==="pending",onClick:m[2]||(m[2]=p=>{f(),o.value=!1})},{default:a(()=>[$(d(l.$t("settings.team.deleteTeam.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["open"])],64)}}}),$t={key:0,class:"grid gap-6"},Rt=A({__name:"general",setup(D){const{t:i}=B(),{currentTeam:r}=N();if(W({title:i("settings.team.title")}),!pt().value)throw X("/auth/login"),new Error("Team not found");return(g,v)=>{const c=gt,_=vt,f=Tt;return e(r)?(k(),x("div",$t,[t(c),t(_,{initialValue:e(r).name,teamId:e(r).id},null,8,["initialValue","teamId"]),t(f)])):R("",!0)}}});export{Rt as default};
