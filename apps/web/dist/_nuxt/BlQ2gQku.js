import{c as I}from"./BJlwRGmy.js";import{_ as re}from"./BGJzcXPY.js";import{o as ie,_ as le}from"./CdoZBVaK.js";import{_ as me,a as ce,b as ue}from"./B_OOLmfa.js";import{d as x,i as f,o as l,w as a,e,c as k,F as j,x as Q,f as _,t as r,j as _e,k as de,l as B,m as pe,N as fe,M as ge,X as he,Y as ve,A as R,a as u,n as y,u as t,K as we,p as q,q as $e,g as be,_ as ye,r as Se,s as Te}from"./8QiH33WF.js";import{_ as ke}from"./BET4E6RN.js";import{u as xe,T as Ve,_ as Fe}from"./CChrxTUx.js";import{_ as Ce}from"./DIY_N1TE.js";import{t as Ae,o as Le,b as Pe,s as S,a as Me,_ as Ee}from"./Cr4JGMLb.js";import{_ as Ue}from"./C73mHSXW.js";import{_ as Ne}from"./DSEaCN0s.js";import{_ as Be}from"./CebZ4Rg0.js";import{_ as Re}from"./D0LHb9o-.js";import{u as qe}from"./q1OLa3wU.js";import{u as D}from"./B8ynWgUJ.js";import{u as Ie}from"./DygIN5F_.js";import{u as T}from"./DYdusctJ.js";import"./C3AzuWgF.js";import"./Brao1_R0.js";import"./B_pj9KdJ.js";const je=x({__name:"SaasSigninModeSwitch",props:{modelValue:{}},emits:["update:modelValue"],setup($,{emit:d}){const g=$,p=d,h=[{value:"magic-link",label:"Magic Link"},{value:"password",label:"Password"}];return(V,v)=>{const i=ce,b=me,w=ue;return l(),f(w,{modelValue:g.modelValue,"onUpdate:modelValue":v[0]||(v[0]=m=>p("update:modelValue",m))},{default:a(()=>[e(b,{class:"w-full"},{default:a(()=>[(l(),k(j,null,Q(h,m=>e(i,{key:m.value,value:m.value,class:"flex-1"},{default:a(()=>[_(r(m.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])}}}),Qe=I(le),De={class:"text-4xl font-bold"},Oe={class:"mb-6 mt-4 text-muted-foreground"},ze={class:"grid grid-cols-1 items-stretch gap-4 md:grid-cols-2"},He={class:"text-center text-sm"},We={class:"text-muted-foreground"},Ge=x({__name:"SaasLoginForm.client",setup($){const d=de(),{apiCaller:g}=qe(),{t:p}=D(),{user:h,loaded:V}=Ie({initialUser:null}),v=Ae(Le({root:S().optional(),email:S().email(),password:Pe(S())})),{searchQuery:i}=T({name:"invitationCode",replace:!0}),{searchQuery:b}=T({name:"redirectTo",replace:!0}),{searchQuery:w}=T({name:"email",replace:!0}),m=_e(()=>i.value?`/team/invitation?code=${i.value}`:b.value||d.public.auth.redirectPath),F=()=>{R(m.value)};B(()=>{h.value&&V.value&&F()});const{zodErrorMap:O,setApiErrorsToForm:z}=xe();Me(O);const C=pe({validationSchema:v,initialValues:{email:""}}),{isSubmitting:H,values:W,resetForm:G,handleSubmit:K,setFieldValue:X,errors:A}=C,c=fe("magic-link");ge(c,async()=>{G(),await he()}),B(()=>{w.value&&X("email",w.value)});const L=K(async s=>{try{if(c.value==="password")await g.auth.loginWithPassword.mutate({email:s.email,password:s.password}),F();else{await g.auth.loginWithEmail.mutate({email:s.email,callbackUrl:ve(d.public.siteUrl,"/auth/verify")});const o=new URLSearchParams;o.set("type","LOGIN"),o.set("redirectTo",m.value),i&&o.set("invitationCode",i.value),s.email&&o.set("identifier",s.email),R(`/auth/otp?${o.toString()}`,{replace:!0})}}catch(o){z(o,C,{defaultError:p("auth.login.hints.invalidCredentials")})}});return(s,o)=>{const Y=re,J=Qe,Z=je,ee=Fe,te=ke,P=Ue,ae=Be,M=Ne,E=Ee,U=$e,oe=Re,N=be,se=Ce,ne=ye;return l(),k("div",null,[u("h1",De,r(s.$t("auth.login.title")),1),u("p",Oe,r(s.$t("auth.login.subtitle")),1),t(i)?(l(),f(Y,{key:0,class:"mb-6"})):y("",!0),u("div",ze,[(l(!0),k(j,null,Q(Object.keys(t(ie)),n=>(l(),f(J,{key:n,provider:n},null,8,["provider"]))),128))]),o[2]||(o[2]=u("hr",{class:"my-8"},null,-1)),u("form",{onSubmit:o[1]||(o[1]=Se((...n)=>t(L)&&t(L)(...n),["prevent"])),class:"flex flex-col items-stretch gap-6"},[e(Z,{class:"w-full",modelValue:t(c),"onUpdate:modelValue":o[0]||(o[0]=n=>we(c)?c.value=n:null)},null,8,["modelValue"]),t(A).root?(l(),f(te,{key:0,variant:"error"},{default:a(()=>[e(t(Ve),{class:"size-6"}),e(ee,null,{default:a(()=>[_(r(t(A).root),1)]),_:1})]),_:1})):y("",!0),e(U,{name:"email"},{default:a(({componentField:n})=>[e(E,null,{default:a(()=>[e(P,{for:"email",required:""},{default:a(()=>[_(r(s.$t("auth.login.email")),1)]),_:1}),e(ae,q(n,{type:"text",id:"email",required:"",autocomplete:"email"}),null,16),e(M)]),_:2},1024)]),_:1}),t(c)==="password"?(l(),f(U,{key:1,name:"password"},{default:a(({componentField:n})=>[e(E,null,{default:a(()=>[e(P,{for:"password",required:""},{default:a(()=>[_(r(s.$t("auth.login.password")),1)]),_:1}),e(oe,q(n,{id:"password",autocomplete:"current-password",required:""}),null,16),e(M),e(se,{class:"text-right"},{default:a(()=>[e(N,{to:"/auth/forgot-password"},{default:a(()=>[_(r(s.$t("auth.login.forgotPassword")),1)]),_:1})]),_:1})]),_:2},1024)]),_:1})):y("",!0),e(ne,{class:"w-full",type:"submit",variant:"secondary",loading:t(H)},{default:a(()=>[_(r(t(c)==="password"?t(p)("auth.login.submit"):t(p)("auth.login.sendMagicLink")),1)]),_:1},8,["loading"]),u("div",He,[u("span",We,r(s.$t("auth.login.dontHaveAnAccount"))+" ",1),e(N,{to:`/auth/signup${t(i)?`?invitationCode=${t(i)}&email=${t(W).email}`:""}`},{default:a(()=>[_(r(s.$t("auth.login.createAnAccount"))+" → ",1)]),_:1},8,["to"])])],32)])}}}),Ke=I(Ge),gt=x({__name:"login",setup($){const{t:d}=D();return Te({title:d("auth.login.title")}),(g,p)=>{const h=Ke;return l(),f(h)}}});export{gt as default};
