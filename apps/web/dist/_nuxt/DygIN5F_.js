import{u as y}from"./q1OLa3wU.js";import{u as M}from"./B_pj9KdJ.js";import{a as C}from"./C3AzuWgF.js";import{aJ as m,j as u,a8 as w,l as J,M as S,A as i}from"./8QiH33WF.js";const B=({initialUser:t}={})=>{const{apiCaller:l}=y(),p=M(),o=C({name:"auth"}),r=e=>{const g=JSON.parse(JSON.stringify(e));o.post(g)},s=m("useUser-loaded",()=>!!t),a=m("useUser-user",()=>t??null),n=u(()=>{var e;return((e=a.value)==null?void 0:e.teamMemberships)??[]}),c=u(()=>n.value.find(e=>e.team.id===p.value)),f=u(()=>{var e;return((e=c.value)==null?void 0:e.team)??null}),d=u(()=>{var e;return((e=c.value)==null?void 0:e.role)??"MEMBER"}),v=async()=>{const e=await l.auth.user.query();a.value=e,s.value=!!e},h=e=>{a.value&&(a.value={...a.value,...e})};return w(async()=>{const e=s.value&&a.value;t!==void 0||e||await v()}),J(()=>{a.value&&s.value&&r({type:"loaded",user:a.value})}),S(o.data,e=>{JSON.stringify(e.user)!==JSON.stringify(a.value)&&(e.type==="logout"?(a.value=null,s.value=!1,i("/")):(a.value=e.user,s.value=!0))}),{user:a,loaded:s,updateUser:h,teamMemberships:n,logout:async()=>{await l.auth.logout.mutate(),a.value=null,s.value=!1,r({type:"logout",user:null}),i("/")},reloadUser:v,currentTeam:f,teamRole:d}};export{B as u};
