import{_ as q}from"./C9wv_TqS.js";import{u as E}from"./BBmSYT-e.js";import{C as H,d as T,j as d,i as S,o as l,u as n,w as y,f as w,t as m,P as V,N as A,_ as L,e as C,A as k,a9 as X,aa as U,n as I,a as b,c as h,F,x as R,K as Y,y as K,E as Z,s as J,l as Q}from"./Di62MCsn.js";import{u as D}from"./DT-NqyXP.js";import{_ as M}from"./BAzBP0PC.js";import{c as W}from"./FTH3AbiA.js";import{b as tt,_ as nt,a as et}from"./Rqz4rimc.js";import{_ as st}from"./DQkquTfZ.js";import{u as at}from"./DJFGLJu-.js";import{u as it}from"./jjbrCQ32.js";import"./CXFSimRl.js";import"./Bk3nVtA8.js";/**
 * @license lucide-vue-next v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=H("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),ct=T({__name:"SaasSubscriptionStatusBadge",props:{status:{}},setup(p){const t=p,{t:s}=E(),e=d(()=>({ACTIVE:s("settings.billing.subscription.status.active"),CANCELED:s("settings.billing.subscription.status.canceled"),EXPIRED:s("settings.billing.subscription.status.expired"),INCOMPLETE:s("settings.billing.subscription.status.incomplete"),PAST_DUE:s("settings.billing.subscription.status.past_due"),PAUSED:s("settings.billing.subscription.status.paused"),TRIALING:s("settings.billing.subscription.status.trialing"),UNPAID:s("settings.billing.subscription.status.unpaid")})),i=d(()=>({ACTIVE:"success",CANCELED:"error",EXPIRED:"error",INCOMPLETE:"warning",PAST_DUE:"warning",PAUSED:"warning",TRIALING:"info",UNPAID:"error"}));return(r,c)=>{const a=q;return l(),S(a,{variant:n(i)[t.status]},{default:y(()=>[w(m(n(e)[t.status]),1)]),_:1},8,["variant"])}}}),ot=T({__name:"SaasCustomerPortalButton",props:{subscriptionId:{}},setup(p){const t=p,{t:s}=E(),{toast:e}=V(),{apiCaller:i}=D(),r=A(!1),c=async()=>{if(!(typeof window>"u")){r.value=!0;try{const a=await i.billing.createCustomerPortalLink.mutate({subscriptionId:t.subscriptionId,redirectUrl:window.location.href});k(a,{external:!0})}catch{e({variant:"error",title:s("settings.billing.createCustomerPortal.notifications.error.title")})}finally{r.value=!1}}};return(a,o)=>{const u=L;return l(),S(u,{variant:"primary",onClick:c,loading:n(r)},{default:y(()=>[C(n(rt),{class:"mr-2 size-4"}),w(" "+m(a.$t("settings.billing.createCustomerPortal.label")),1)]),_:1},8,["loading"])}}}),lt=T({__name:"SaasCancelSubscriptionButton",props:{subscriptionId:{}},setup(p){const t=p,{t:s}=E(),{toast:e}=V(),{apiCaller:i}=D(),r=A(!1),c=async()=>{if(!(typeof window>"u")){r.value=!0;try{await i.billing.cancelSubscription.mutate({id:t.subscriptionId}),e({variant:"success",title:s("settings.billing.cancelSubscription.notifications.success.title")}),location.reload()}catch{e({variant:"error",title:s("settings.billing.cancelSubscription.notifications.error.title")})}finally{r.value=!1}}};return(a,o)=>{const u=L;return l(),S(u,{variant:"outline",onClick:c,loading:n(r)},{default:y(()=>[C(n(X),{class:"mr-2 size-4"}),w(" "+m(a.$t("settings.billing.subscription.cancel")),1)]),_:1},8,["loading"])}}}),O=()=>{const{locale:p,getNumberFormat:t}=U();return{localeCurrency:d(()=>{var e,i;return((i=(e=t(p.value))==null?void 0:e.currency)==null?void 0:i.currency)||W.i18n.defaultCurrency})}},ut=()=>{const{locale:p}=U();return{formatDate:({date:s})=>s?new Intl.DateTimeFormat(p.value).format(s):""}},pt={class:"flex items-center gap-2"},dt={class:"text-lg font-bold text-primary"},mt={class:"font-normal"},bt={key:0,class:"mt-1 text-muted-foreground"},_t={key:1,class:"-mx-6 -mb-6 mt-6 flex justify-end border-t px-6 py-3"},ft={class:"flex w-full flex-col justify-between gap-3 md:flex-row"},gt={class:"flex flex-col gap-3 md:flex-row"},vt=T({__name:"SaasSubscriptionOverview",props:{plans:{},currentSubscription:{}},setup(p){const t=p,{n:s,t:e}=E(),{localeCurrency:i}=O(),r=d(()=>({id:"free",name:e("settings.billing.subscription.freePlan.title"),variants:[{id:"free",interval_count:1,price:0,interval:"month",currency:i.value}]})),c=d(()=>t.currentSubscription?t.currentSubscription.planId:"free"),a=d(()=>t.currentSubscription?t.currentSubscription.variantId:"free"),o=d(()=>[r.value,...t.plans].find(g=>g.id===c.value)),u=d(()=>{var g;return(g=o.value)==null?void 0:g.variants.find(x=>x.id===a.value)}),v=d(()=>t.currentSubscription?t.currentSubscription.status==="CANCELED"||t.currentSubscription.status==="PAUSED":!1),_=d(()=>t.currentSubscription?t.currentSubscription.status==="ACTIVE"||t.currentSubscription.status==="TRIALING":!1),{formatDate:f}=ut(),P=d(()=>{const g=t.currentSubscription;if(!g)return;const x=g.nextPaymentDate?new Date(g.nextPaymentDate):null;return x?v.value?e("settings.billing.subscription.endsOn",{nextPaymentDate:f({date:x})}):e("settings.billing.subscription.nextPayment",{nextPaymentDate:f({date:x})}):void 0});return(g,x)=>{const $=ct,j=ot,G=lt,z=M;return n(o)&&n(u)?(l(),S(z,{key:0},{title:y(()=>[w(m(g.$t("settings.billing.subscription.currentSubscription")),1)]),default:y(()=>{var N,B;return[b("div",pt,[b("h4",dt,[b("span",null,m(n(o).name),1),b("small",mt," ("+m(n(s)(n(u).price/100,"currency"))+"/"+m(n(e)(`settings.billing.subscription.${n(u).interval}`))+") ",1)]),(N=t.currentSubscription)!=null&&N.status?(l(),S($,{key:0,status:t.currentSubscription.status},null,8,["status"])):I("",!0)]),(B=t.currentSubscription)!=null&&B.nextPaymentDate?(l(),h("p",bt,m(n(P)),1)):I("",!0),t.currentSubscription?(l(),h("div",_t,[b("div",ft,[b("div",null,[C(j,{subscriptionId:t.currentSubscription.id},null,8,["subscriptionId"])]),b("div",gt,[n(_)?(l(),S(G,{key:0,subscriptionId:t.currentSubscription.id},null,8,["subscriptionId"])):I("",!0)])])])):I("",!0)]}),_:1})):I("",!0)}}}),yt={key:0,class:"rounded-xl bg-card/50 p-6 shadow"},Pt={class:"flex h-full flex-col justify-between gap-4"},St={class:"mb-4 text-2xl font-bold"},It=["innerHTML"],ht={key:1,class:"grid list-disc gap-2 pl-4 text-muted-foreground"},xt={class:"text-2xl font-bold text-highlight","data-test":"price-table-plan-price"},Ct={class:"text-sm font-normal opacity-70"},wt=T({__name:"PricingTableItem",props:{onSelectPlan:{type:Function},plan:{},interval:{},activePlanId:{},labels:{}},setup(p){const t=p,{n:s}=E(),e=d(()=>t.plan.variants.find(o=>o.interval===t.interval)),i=d(()=>t.activePlanId===t.plan.id),r=d(()=>i.value?t.labels.currentPlan:t.activePlanId?t.labels.switchToPlan:t.labels.subscribe),c=A(!1),a=async()=>{try{if(!e.value)throw new Error("No variant found");c.value=!0,await t.onSelectPlan(t.plan.id,String(e.value.id)),c.value=!1}catch{}finally{c.value=!1}};return(o,u)=>{var _;const v=L;return n(e)?(l(),h("div",yt,[b("div",Pt,[b("div",null,[b("h3",St,m(t.plan.name),1),t.plan.description?(l(),h("div",{key:0,class:"prose mb-2 text-muted-foreground",innerHTML:t.plan.description},null,8,It)):I("",!0),(_=t.plan.features)!=null&&_.length?(l(),h("ul",ht,[(l(!0),h(F,null,R(o.plan.features,(f,P)=>(l(),h("li",{key:P},m(f),1))),128))])):I("",!0)]),b("div",null,[b("strong",xt,[w(m(n(s)(n(e).price/100,"currency"))+" ",1),b("span",Ct," / "+m(t.labels[o.interval]),1)]),C(v,{disabled:n(i),loading:n(c),onClick:a,class:"mt-4 w-full"},{default:y(()=>[w(m(n(r)),1)]),_:1},8,["disabled","loading"])])])])):I("",!0)}}}),Tt={class:"flex justify-center"},Et={class:"grid gap-4 @md:grid-cols-3"},$t=T({__name:"PricingTable",props:{onSelectPlan:{type:Function},plans:{},activePlanId:{},class:{}},setup(p){const t=p,{localeCurrency:s}=O(),{t:e}=E(),i=d(()=>({currentPlan:e("settings.billing.subscription.currentPlan"),yearly:e("settings.billing.subscription.yearly"),monthly:e("settings.billing.subscription.monthly"),year:e("settings.billing.subscription.year"),month:e("settings.billing.subscription.month"),subscribe:e("settings.billing.subscription.subscribe"),switchToPlan:e("settings.billing.subscription.switchToPlan")})),r=A("month"),c=d(()=>[...t.plans].map(a=>{const o=a.variants.filter(u=>u.interval===r.value&&u.currency.toLowerCase()===s.value.toLowerCase()).sort((u,v)=>u.price-v.price);return{...a,variants:o}}).filter(a=>a.variants.length>0).sort((a,o)=>{const u=a.variants.reduce((_,f)=>Math.min(_,f.price),Number.POSITIVE_INFINITY),v=o.variants.reduce((_,f)=>Math.min(_,f.price),Number.POSITIVE_INFINITY);return u-v}));return(a,o)=>{const u=et,v=nt,_=tt,f=wt;return l(),h("div",{class:K(("cn"in a?a.cn:n(Z))(t.class,"@container"))},[b("div",Tt,[C(_,{modelValue:n(r),"onUpdate:modelValue":o[0]||(o[0]=P=>Y(r)?r.value=P:null),class:"mb-4","data-test":"price-table-interval-tabs"},{default:y(()=>[C(v,null,{default:y(()=>[C(u,{value:"month"},{default:y(()=>[w(m(n(i).monthly),1)]),_:1}),C(u,{value:"year"},{default:y(()=>[w(m(n(i).yearly),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),b("div",Et,[(l(!0),h(F,null,R(n(c),P=>(l(),S(f,{onSelectPlan:t.onSelectPlan,key:P.id,plan:P,interval:n(r),labels:{month:n(i).month,year:n(i).year,currentPlan:n(i).currentPlan,switchToPlan:n(i).switchToPlan,subscribe:n(i).subscribe},activePlanId:t.activePlanId,"data-test":"price-table-plan"},null,8,["onSelectPlan","plan","interval","labels","activePlanId"]))),128))])],2)}}}),kt=T({__name:"SaasUpgradePlan",props:{plans:{},teamId:{},activePlanId:{}},setup(p){const t=p,{apiCaller:s}=D(),e=async(i,r)=>{if(!(typeof window>"u"))try{const c=await s.billing.createCheckoutLink.mutate({planId:i,variantId:r,teamId:t.teamId,redirectUrl:window.location.href});k(c,{external:!0})}catch{}};return(i,r)=>{const c=$t,a=M;return l(),S(a,null,{title:y(()=>[w(m(i.$t("settings.billing.subscription.upgradePlan")),1)]),default:y(()=>[C(c,{plans:t.plans,activePlanId:t.activePlanId,onSelectPlan:e,class:"md:-mt-12"},null,8,["plans","activePlanId"])]),_:1})}}}),At={key:0,class:"grid gap-6"},zt=T({__name:"billing",setup(p){const{t}=E(),{apiCaller:s}=D();J({title:t("settings.billing.title")});const{data:e,pending:i}=at(async()=>{const r=it();if(!r.value)return k("/auth/login"),null;const c=await s.team.byId.query({id:r.value}),[a,o]=await Promise.all([s.billing.plans.query(),s.team.subscription.query({teamId:c.id})]);return{team:c,plans:a,teamSubscription:o}},"$L-ZbpM0_0T");return Q(()=>{var r;!i.value&&!((r=e.value)!=null&&r.team)&&k("/auth/login")}),(r,c)=>{var v,_,f,P,g,x,$;const a=vt,o=kt,u=st;return n(i)?(l(),S(u,{key:1})):(l(),h("div",At,[(v=n(e))!=null&&v.plans?(l(),S(a,{key:0,plans:n(e).plans,currentSubscription:n(e).teamSubscription},null,8,["plans","currentSubscription"])):I("",!0),(_=n(e))!=null&&_.plans&&((P=(f=n(e))==null?void 0:f.team)==null?void 0:P.status)==="ASSIGNED"&&!["ACTIVE","TRIALING"].includes(((x=(g=n(e))==null?void 0:g.teamSubscription)==null?void 0:x.status)||"")?(l(),S(o,{key:1,plans:n(e).plans,activePlanId:($=n(e).teamSubscription)==null?void 0:$.planId,teamId:n(e).team.id},null,8,["plans","activePlanId","teamId"])):I("",!0)]))}}});export{zt as default};
