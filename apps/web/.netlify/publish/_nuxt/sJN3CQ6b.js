import{_ as Ve}from"./BCTRTFrT.js";import{_ as Pe,a as Ne,b as Ce,c as Ue,d as Ie}from"./DMYLyJLv.js";import{d as $e,l as Oe,j as _,N as x,c as f,a as t,n as O,t as d,u as l,f as r,e as s,K as S,w as n,ao as E,ap as ue,F as G,x as X,_ as Ee,a2 as De,o as c,i as de,aq as re,ar as Me}from"./Di62MCsn.js";import{c as Re,a as Le,_ as We,b as Ae}from"./B3HjOky3.js";import{_ as Be,a as ze}from"./1RP2yTVK.js";import{u as Fe}from"./DT-NqyXP.js";import{u as He}from"./CjtIy_jz.js";import{u as Ge}from"./jjbrCQ32.js";import{u as A,r as D}from"./DJFGLJu-.js";import"./DFM8vr2N.js";import"./CXFSimRl.js";const Xe={class:"container mx-auto p-6"},Ye={class:"text-2xl font-semibold mb-1 text-foreground"},je={key:0,class:"text-sm text-muted-foreground mb-4"},qe={key:0},Je={key:1},Ke={key:2},Qe={class:"grid grid-cols-1 md:grid-cols-5 gap-3 mb-4"},Ze={class:"flex items-end gap-3"},et={class:"flex items-center gap-2 text-sm text-gray-500"},tt={class:"mb-4 text-sm text-muted-foreground"},at={key:0,class:"mb-6 rounded-md border bg-background"},lt={class:"p-4 border-b flex items-center justify-between"},ot={class:"text-xs px-2 py-1 rounded bg-muted text-foreground"},st={class:"p-4 flex flex-col gap-3"},nt={class:"text-foreground text-sm"},ut={key:0,class:"text-muted-foreground"},dt={class:"text-foreground font-medium"},rt={key:0,class:"text-xs text-yellow-600 dark:text-yellow-400"},it={key:1,class:"text-xs text-muted-foreground"},mt={key:2,class:"text-xs text-muted-foreground"},ct={class:"flex flex-wrap items-end gap-4"},pt={class:"pb-1"},ft={class:"min-w-full border text-sm"},vt={class:"p-2 border"},_t=["onUpdate:modelValue"],bt={class:"p-2 border"},xt=["onUpdate:modelValue"],yt={class:"p-2 border"},gt=["onUpdate:modelValue"],St={class:"p-2 border"},wt=["onUpdate:modelValue"],ht={class:"p-2 border flex gap-2"},kt=["onClick"],Tt=["onClick"],zt=$e({__name:"index",setup(Vt){const{apiCaller:M}=Fe(),{user:Y}=He(),B=Ge();Oe(()=>{var a,e;!B.value&&((e=(a=Y.value)==null?void 0:a.teamMemberships)!=null&&e.length)&&(B.value=Y.value.teamMemberships[0].team.id)});const u=_(()=>B.value||null),{data:k,pending:Pt}=A("team-byid",async()=>{if(!u.value)return null;try{return await M.team.byId.query({id:u.value})}catch{return null}},{watch:[u],lazy:!0}),{data:ie,pending:Nt}=A("team-players",async()=>u.value?await $fetch("/api/team/players",{params:{teamId:u.value}}):[],{watch:[u],lazy:!0}),{data:j,pending:Ct}=A("team-schedule",async()=>u.value?await $fetch("/api/team/schedule",{params:{teamId:u.value}}):[],{watch:[u],lazy:!0}),{data:i,pending:Ut}=A("team-unreported",async()=>u.value?await $fetch("/api/match/unreported",{params:{teamId:u.value}}):null,{watch:[u],lazy:!0}),h=x("WIN"),y=x("3-0"),z=x(!1),R=x(""),me=_(()=>{var a;return!i.value||!u.value?"":((a=i.value.homeTeam)==null?void 0:a.id)===u.value?"Home":"Away"});function ce(a){const[e,v]=a.split("-").map(b=>Number(b));return[e,v]}const pe=_(()=>h.value==="WIN"?["3-0","3-1","3-2"]:["0-3","1-3","2-3"]);async function fe(){var a;if(!(!i.value||!u.value)){z.value=!0;try{h.value==="WIN"&&!y.value.startsWith("3-")&&(y.value="3-0"),h.value==="LOSS"&&!y.value.endsWith("-3")&&(y.value="0-3");const[e,v]=ce(y.value),b=((a=i.value.homeTeam)==null?void 0:a.id)===u.value,g=e,m=v,W=await $fetch("/api/match/report",{method:"POST",body:{matchId:i.value.id,teamId:u.value,myScore:g,theirScore:m,notes:R.value||void 0}});await Promise.all([D("team-schedule"),D("team-unreported")])}catch{}finally{z.value=!1}}}function q(){var a;try{return(a=i.value)!=null&&a.notes?JSON.parse(i.value.notes):{}}catch{return{}}}const J=_(()=>{var a;return!!i.value&&!!u.value&&((a=i.value.homeTeam)==null?void 0:a.id)===u.value}),T=_(()=>{const a=q();return J.value?a.homeSubmit:a.awaySubmit}),V=_(()=>{const a=q();return J.value?a.awaySubmit:a.homeSubmit}),L=_(()=>{var a;return!!T.value&&!V.value&&((a=i.value)==null?void 0:a.status)!=="NEEDS_RESOLUTION"}),ve=_(()=>{var a;return!T.value&&!!V.value&&((a=i.value)==null?void 0:a.status)!=="NEEDS_RESOLUTION"});_(()=>!!T.value&&!!V.value);const F=_(()=>{var b,g;let a=0,e=0,v=0;for(const m of j.value||[])m.status==="COMPLETED"&&(((b=m.homeTeam)==null?void 0:b.id)===u.value?(m.homeScore??0)>(m.awayScore??0)?a++:(m.homeScore??0)<(m.awayScore??0)?e++:v++:((g=m.awayTeam)==null?void 0:g.id)===u.value&&((m.awayScore??0)>(m.homeScore??0)?a++:(m.awayScore??0)<(m.homeScore??0)?e++:v++));return{w:a,l:e,t:v}}),_e=M.team.addPlayer.useMutation(),be=M.team.updatePlayer.useMutation(),xe=M.team.removePlayer.useMutation(),w=x(""),P=x(""),N=x(""),C=x(""),U=x(!1);async function ye(a){await be.mutate({id:a.id,name:a.name,gamerTag:a.gamerTag||null,platform:a.platform||null,role:a.role||null,isSub:!!a.isSub}),await D("team-players")}async function ge(){!u.value||!w.value||(await _e.mutate({teamId:u.value,name:w.value,gamerTag:P.value||void 0,platform:N.value||void 0,role:C.value||void 0,isSub:U.value}),w.value="",P.value="",N.value="",C.value="",U.value=!1,await D("team-players"))}async function Se(a){await xe.mutate({id:a}),await D("team-players")}return(a,e)=>{var Z,ee,te,ae,le,oe,se,ne;const v=Ve,b=Ce,g=Ne,m=Ie,W=Ue,H=Pe,K=Ee,we=De("Textarea"),I=ze,Q=Le,he=Be,$=Ae,ke=We,Te=Re;return c(),f("div",Xe,[t("h1",Ye,d(((Z=l(k))==null?void 0:Z.name)||"Team"),1),(ee=l(k))!=null&&ee.region?(c(),f("p",je,[r(d(l(k).region)+" ",1),(te=l(k))!=null&&te.division?(c(),f("span",qe,"· Div "+d(l(k).division.level),1)):O("",!0)])):O("",!0),l(u)?(c(),f("div",Ke,[t("div",Qe,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Name",-1)),s(v,{modelValue:l(w),"onUpdate:modelValue":e[0]||(e[0]=o=>S(w)?w.value=o:null),placeholder:"Player name"},null,8,["modelValue"])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Gamer Tag",-1)),s(v,{modelValue:l(P),"onUpdate:modelValue":e[1]||(e[1]=o=>S(P)?P.value=o:null),placeholder:"Gamer tag"},null,8,["modelValue"])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Platform",-1)),s(H,{modelValue:l(N),"onUpdate:modelValue":e[2]||(e[2]=o=>S(N)?N.value=o:null)},{default:n(()=>[s(g,null,{default:n(()=>[s(b,{placeholder:"Select"})]),_:1}),s(W,null,{default:n(()=>[s(m,{value:"PS"},{default:n(()=>e[10]||(e[10]=[r("PlayStation")])),_:1,__:[10]}),s(m,{value:"XB"},{default:n(()=>e[11]||(e[11]=[r("Xbox")])),_:1,__:[11]}),s(m,{value:"PC"},{default:n(()=>e[12]||(e[12]=[r("PC")])),_:1,__:[12]})]),_:1})]),_:1},8,["modelValue"])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Role",-1)),s(v,{modelValue:l(C),"onUpdate:modelValue":e[3]||(e[3]=o=>S(C)?C.value=o:null),placeholder:"Role (e.g., Captain)"},null,8,["modelValue"])]),t("div",Ze,[t("label",et,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=o=>S(U)?U.value=o:null)},null,512),[[ue,l(U)]]),e[15]||(e[15]=r(" Sub"))]),s(K,{onClick:ge,disabled:!l(w)},{default:n(()=>e[16]||(e[16]=[r("Add player")])),_:1,__:[16]},8,["disabled"])])]),t("div",tt,"Record: "+d(l(F).w)+"-"+d(l(F).l)+"-"+d(l(F).t),1),l(i)?(c(),f("div",at,[t("div",lt,[e[17]||(e[17]=t("div",{class:"text-sm text-muted-foreground"},"Newest unreported match",-1)),t("div",ot,d(l(me)),1)]),t("div",st,[t("div",nt,[r(" Week "+d(l(i).weekNumber)+" · "+d(new Date(l(i).scheduledAt).toLocaleString())+" ",1),(le=(ae=l(i))==null?void 0:ae.division)!=null&&le.teamSize?(c(),f("span",ut," · "+d(l(i).division.teamSize)+"v"+d(l(i).division.teamSize),1)):O("",!0)]),t("div",dt,d((oe=l(i).homeTeam)==null?void 0:oe.name)+" vs "+d((se=l(i).awayTeam)==null?void 0:se.name),1),((ne=l(i))==null?void 0:ne.status)==="NEEDS_RESOLUTION"?(c(),f("div",rt," Winner conflict — Needs Resolution. Admins will review. ")):l(L)?(c(),f("div",it," Your submission: "+d(l(T).scoreFor)+"-"+d(l(T).scoreAgainst)+" · Waiting for opponent to confirm. ",1)):l(ve)?(c(),f("div",mt," Opponent submitted: "+d(l(V).scoreFor)+"-"+d(l(V).scoreAgainst)+" · Please submit your result. ",1)):O("",!0),t("div",ct,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Outcome",-1)),s(H,{modelValue:l(h),"onUpdate:modelValue":e[5]||(e[5]=o=>S(h)?h.value=o:null),disabled:l(L)},{default:n(()=>[s(g,{class:"w-32"},{default:n(()=>[s(b,{placeholder:"Outcome"})]),_:1}),s(W,null,{default:n(()=>[s(m,{value:"WIN"},{default:n(()=>e[18]||(e[18]=[r("Win")])),_:1,__:[18]}),s(m,{value:"LOSS"},{default:n(()=>e[19]||(e[19]=[r("Loss")])),_:1,__:[19]})]),_:1})]),_:1},8,["modelValue","disabled"])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Score",-1)),s(H,{modelValue:l(y),"onUpdate:modelValue":e[6]||(e[6]=o=>S(y)?y.value=o:null),disabled:l(L)},{default:n(()=>[s(g,{class:"w-32"},{default:n(()=>[s(b,{placeholder:"Score"})]),_:1}),s(W,null,{default:n(()=>[(c(!0),f(G,null,X(l(pe),o=>(c(),de(m,{key:o,value:o},{default:n(()=>[r(d(o),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])]),t("div",pt,[s(K,{disabled:l(z)||l(L),onClick:fe},{default:n(()=>e[22]||(e[22]=[r("Submit result")])),_:1,__:[22]},8,["disabled"])])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-muted-foreground mb-1"},"Notes (optional)",-1)),s(we,{modelValue:l(R),"onUpdate:modelValue":e[7]||(e[7]=o=>S(R)?R.value=o:null),placeholder:"Explain anything unusual (disconnects, FF, etc.)",class:"border border-border rounded-md p-3 text-sm placeholder:text-xs placeholder:text-muted-foreground/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30"},null,8,["modelValue"])]),e[24]||(e[24]=t("div",{class:"text-xs text-muted-foreground"},"Both teams must submit the same score to confirm.",-1))])])):O("",!0),t("table",ft,[e[26]||(e[26]=t("thead",{class:"bg-muted"},[t("tr",null,[t("th",{class:"p-2 border text-left"},"Player"),t("th",{class:"p-2 border text-left"},"Gamer Tag"),t("th",{class:"p-2 border text-left"},"Platform"),t("th",{class:"p-2 border text-left"},"Sub"),t("th",{class:"p-2 border text-left"})])],-1)),t("tbody",null,[(c(!0),f(G,null,X(l(ie)||[],o=>(c(),f("tr",{key:o.id,class:"odd:bg-background even:bg-muted/50"},[t("td",vt,[E(t("input",{"onUpdate:modelValue":p=>o.name=p,class:"border rounded px-2 py-1 w-full",placeholder:"Name"},null,8,_t),[[re,o.name]])]),t("td",bt,[E(t("input",{"onUpdate:modelValue":p=>o.gamerTag=p,class:"border rounded px-2 py-1 w-full",placeholder:"Gamer Tag"},null,8,xt),[[re,o.gamerTag]])]),t("td",yt,[E(t("select",{"onUpdate:modelValue":p=>o.platform=p,class:"border rounded px-2 py-1 w-full"},e[25]||(e[25]=[t("option",{value:null},"Select",-1),t("option",{value:"PS"},"PlayStation",-1),t("option",{value:"XB"},"Xbox",-1),t("option",{value:"PC"},"PC",-1)]),8,gt),[[Me,o.platform]])]),t("td",St,[E(t("input",{type:"checkbox","onUpdate:modelValue":p=>o.isSub=p},null,8,wt),[[ue,o.isSub]])]),t("td",ht,[t("button",{class:"px-3 py-1 border rounded",onClick:p=>ye(o)},"Save",8,kt),t("button",{class:"px-3 py-1 border rounded",onClick:p=>Se(o.id)},"Remove",8,Tt)])]))),128))])]),e[32]||(e[32]=t("h2",{class:"text-xl font-semibold mt-8 mb-3"},"Schedule",-1)),s(Te,null,{default:n(()=>[s(he,null,{default:n(()=>[s(Q,null,{default:n(()=>[s(I,null,{default:n(()=>e[27]||(e[27]=[r("Week")])),_:1,__:[27]}),s(I,null,{default:n(()=>e[28]||(e[28]=[r("Date")])),_:1,__:[28]}),s(I,null,{default:n(()=>e[29]||(e[29]=[r("Home")])),_:1,__:[29]}),s(I,null,{default:n(()=>e[30]||(e[30]=[r("Away")])),_:1,__:[30]}),s(I,null,{default:n(()=>e[31]||(e[31]=[r("Status")])),_:1,__:[31]})]),_:1})]),_:1}),s(ke,null,{default:n(()=>[(c(!0),f(G,null,X(l(j)||[],o=>(c(),de(Q,{key:o.id},{default:n(()=>[s($,null,{default:n(()=>[r(d(o.weekNumber),1)]),_:2},1024),s($,null,{default:n(()=>[r(d(new Date(o.scheduledAt).toLocaleString()),1)]),_:2},1024),s($,null,{default:n(()=>{var p;return[r(d((p=o.homeTeam)==null?void 0:p.name),1)]}),_:2},1024),s($,null,{default:n(()=>{var p;return[r(d((p=o.awayTeam)==null?void 0:p.name),1)]}),_:2},1024),s($,null,{default:n(()=>[r(d(o.status),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(c(),f("div",Je,"You are not on a team yet."))])}}});export{zt as default};
