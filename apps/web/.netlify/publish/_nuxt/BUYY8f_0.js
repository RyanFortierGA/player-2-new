import{_ as $}from"./GVDJxUYS.js";import{_ as w,v as S}from"./DaIKFIDr.js";import{u as A}from"./CjtIy_jz.js";import{u as B}from"./DT-NqyXP.js";import{d as M,N as u,c as U,o as _,F as j,a as z,e as p,n as D,u as t,T as R,k as T}from"./Di62MCsn.js";import{u as V}from"./DFM8vr2N.js";const E={key:0,class:"bg-card/90 absolute inset-0 z-20 flex items-center justify-center"},I=M({__name:"SaasUserAvatarUpload",emits:["success","error"],setup(O,{emit:C}){const m=C,c=u(!1),d=u(null),n=u(!1),k=u(),{updateUser:g,user:s}=A(),{apiCaller:f}=B(),y=T(),b=f.uploads.signedUploadUrl.useMutation(),h=f.auth.update.useMutation(),{open:x,onChange:F}=V({accept:"image/png,image/jpg,image/jpg",multiple:!1});F(a=>{a!=null&&a.length&&(d.value=a[0],n.value=!0)});const N=async a=>{if(!(!a||!s.value)){c.value=!0;try{const e=y.public.s3AvatarsBucketName,r=`${s.value.id}-${S()}.png`,l=await b.mutate({path:r,bucket:e});if(!l)throw new Error("Failed to get upload url");await $fetch(l,{method:"PUT",body:a,headers:{"Content-Type":"image/png"}});const o=await h.mutate({avatarUrl:r});g&&g({avatarUrl:o==null?void 0:o.avatarUrl}),m("success")}catch{m("error")}finally{c.value=!1}}};return(a,e)=>{var o,v;const r=$,l=w;return _(),U(j,null,[z("div",{ref_key:"dropZoneRef",ref:k,class:"relative cursor-pointer rounded-full",onClick:e[0]||(e[0]=i=>t(x)())},[p(r,{class:"size-24 cursor-pointer text-xl",avatarUrl:(o=t(s))==null?void 0:o.avatarUrl,name:((v=t(s))==null?void 0:v.name)??""},null,8,["avatarUrl","name"]),t(c)?(_(),U("div",E,[p(t(R),{class:"text-primary size-6 animate-spin"})])):D("",!0)],512),p(l,{open:t(n),image:t(d),onOpenChange:e[1]||(e[1]=i=>n.value=i),onSave:e[2]||(e[2]=i=>(N(i),n.value=!1))},null,8,["open","image"])],64)}}});export{I as _};
